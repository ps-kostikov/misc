#include <yandex/maps/sprav/model/storages/revision.h>
#include <yandex/maps/sprav/model/convert.h>
#include <yandex/maps/sprav/common/config.h>
#include <yandex/maps/sprav/common/stopwatch.h>
#include <yandex/maps/sprav/algorithms/datamodel/company.h>
#include <yandex/maps/sprav/algorithms/similarity/similarity.h>
#include <yandex/maps/sprav/algorithms/unification/email_unifier.h>
#include <yandex/maps/sprav/algorithms/unification/url_unifier.h>
#include <yandex/maps/sprav/algorithms/unification/address_unifier.h>

#include <yandex/maps/pgpool2/pgpool.h>
#include <yandex/maps/common/exception.h>

#include <boost/lexical_cast.hpp>

#include <iostream>
#include <fstream>
#include <string>
#include <algorithm>


namespace sprav = maps::sprav;
namespace model = maps::sprav::model;
namespace algorithms = maps::sprav::algorithms;


struct ReadSessionHolder {
    ReadSessionHolder(maps::pgpool2::ConnectionMgr& connMgr) :
        transaction(connMgr.readTransaction()),
        storage(new model::RevisionStorage(*transaction)),
        session(storage, model::Session::CachingPolicy::CacheAll)
    {}

    maps::pgpool2::PgTransaction transaction;
    std::shared_ptr<model::RevisionStorage> storage;
    model::Session session;
};


int main()
{
    std::cout << "hello" << std::endl;

    auto connectionManager =
        sprav::config::createConnectionManager(
            sprav::config::config(),
            sprav::config::ConnectionPoolProfile::Editor);
    ReadSessionHolder holder(*connectionManager);

    std::vector<model::ID> ids{
        116078895,
        116088740,
        116108899,
        116108901,
        116299347,
        116269464,
        116389336,
        116439608,
        116540172,
        116539948,
        116840588,
        116991030,
        116991102,
        117011044,
        117261749,
        117261778,
        117372635,
        117613049,
        117692904,
        117712927,
        117773196,
        117833539,
        117903542,
        118173989,
        118224644,
        118395252,
        118395459,
        118525789,
        118565229,
        118636069,
        118635848,
        118806690,
        118896582,
        118896889,
        119087192,
        119317664,
        119197389,
        119428577,
        119388335,
        119458543,
        119879324,
        120000315,
        120451361,
        120451667,
        120542303,
        120542549,
        120662411,
        120592669,
        120823035,
        120901877,
        120943554,
        120943558,
        121073428,
        121233748,
        121233825,
        121304420,
        121324702,
        121414188,
        121454605,
        121564880,
        121564882,
        121605102,
        121654401,
        121654845,
        121654860,
        121754847,
        121804093,
        122206928,
        122207040,
        122286956,
        122327316,
        122497446,
        122608044,
        122738857,
        122748802,
        122888656,
        123089545,
        123500831,
        123571004,
        123851889,
        124003075,
        124012913,
        124003197,
        124003215,
        124001851,
        124002058,
        124193590,
        124755609,
        124755756,
        124915955,
        124916001,
        124996937,
        124945911,
        125227123,
        124946347,
        125117002,
        125287683,
        125307673,
        125287044,
        125287046,
        125577669,
        125648480,
        125658565,
        125788644,
        125838771,
        126049444,
        126059525,
        126140021,
        126149551,
        126150110,
        126401028,
        126501242,
        126622147,
        126902646,
        126952136,
        127083628,
        127083648,
        127083914,
        127143652,
        127123576,
        127184197,
        127484687,
        127554479,
        127594561,
        127595125,
        127786737,
        128006916,
        128137370,
        128207613,
        128227769,
        128257893,
        128448002,
        128487671,
        128528703,
        128689003,
        129161244,
        129161319,
        129361263,
        129522194,
        129742133,
        129742145,
        129812358,
        129892832,
        130263690,
        130334124,
        130393641,
        130513878,
        130524314,
        130575144,
        130625559,
        130635624,
        130795643,
        130805592,
        130836103,
        130946081,
        131006331,
        131186396,
        131276981,
        131246747,
        131417422,
        131507594,
        131508010,
        131617965,
        131648273,
        131758463,
        131949039,
        132580755,
        132661360,
        132731193,
        132731215,
        132731316,
        132932119,
        133092170,
        133182469,
        133162441,
        133372647,
        133302140,
        133473314,
        133534078,
        133694307,
        133694605,
        133774361,
        133654023,
        133924242,
        133905066,
        134155735,
        134305271,
        134375505,
        134405799,
        134405800,
        134466376,
        134837382,
        134867058,
        134948194,
        135068158,
        135058268,
        135479572,
        135529203,
        136001730,
        136031942,
        135659779,
        136252332,
        136512934,
        136522582,
        136523100,
        136523206,
        135760212,
        136763228,
        136763710,
        136773634,
        136883532,
        136984383,
        136994395,
        137184481,
        137243731,
        137243831,
        137284225,
        137284228,
        137284570,
        137284683,
        137284903,
        137434594,
        137736571,
        137937188,
        137847335,
        137936760,
        138087649,
        138097822,
        138117868,
        138358315,
        138418398,
        138547806,
        138498456,
        138608781,
        138788491,
        139029528,
        138989020,
        139089950,
        139180841,
        139342098,
        139161124,
        139241582,
        139341566,
        139372007,
        139473146,
        139673736,
        139713357,
        139764065,
        139783614,
        139953688,
        139953837,
        139953852,
        140104484,
        140385729,
        140185555,
        140355814,
        140435948,
        140795735,
        140796222,
        140806931,
        140817028,
        140847026,
        140906875,
        141006482,
        140969687,
        141307502,
        141307511,
        141307578,
        141307812,
        141337573,
        141337669,
        141437867,
        141437993,
        141658805,
        141799028,
        141849157,
        142029395,
        142028351,
        142028352,
        142500706,
        142962183,
        143041664,
        143382310,
        143593580,
        143663847,
        143893968,
        143724034,
        143573346,
        144033691,
        143753932,
        144104555,
        144325321,
        144446560,
        144647995,
        144967700,
        145078147,
        145239267,
        145359009,
        145328164,
        145528067,
        145679683,
        145690172,
        145739945,
        145729800,
        145799972,
        145850048,
        145960920,
        145971817,
        146111269,
        146021595,
        146122113,
        146202105,
        146382468,
        146432906,
        146612051,
        146653507,
        146743443,
        147094593,
        147114798,
        147155031,
        147365816,
        147425935,
        147445841,
        147445844,
        147475636,
        147547263,
        147747440,
        147777833,
        147777889,
        147867792,
        148068542,
        148238721,
        148218528,
        148389304,
        148479609,
        148479410,
        148629724,
        148749785,
        148960216,
        149048937,
        149049049,
        149049093,
        149340995,
        149392678,
        149362304,
        149432141,
        149623323,
        149693526,
        149694005,
        149863743,
        149873768,
        149862945,
        149862950,
        150184017,
        150184040,
        150283597,
        150314677,
        150314302,
        150314422,
        150314472,
        150344371,
        150492724,
        150535502,
        150644487,
        150644488,
        150644489,
        150644627,
        150645127,
        150724732,
        150725806,
        150755103,
        150916112,
        150945138,
        150945235,
        150945246,
        150945314,
        150945349,
        150945412,
        150945425,
        150945428,
        150945430,
        150945551,
        151056410,
        151036235,
        151066071,
        151036305,
        151036547,
        151086708,
        151116575,
        151186748,
        151467010,
        151467011,
        151467012,
        151467379,
        151617291,
        151859282,
        152180620,
        152230689,
        152260837,
        152259842,
        152300530,
        152390717,
        152400658,
        152611724,
        152721561,
        152972513,
        152992744,
        153162874,
        153172549,
        153283655,
        153323663,
        153425122,
        153465261,
        153405100,
        153575786,
        153665488,
        153666037,
        153675825,
        153705908,
        153705980,
        154216953,
        154327464,
        154347219,
        154367811,
        154377495,
        154377682,
        153996126,
        154547840,
        154578991,
        153976464,
        153976466,
        153976468,
        153995615,
        154669179,
        154949803,
        155210937,
        155211103,
        155491231,
        155491297,
        155551407,
        155732896,
        155732918,
        155832797,
        155843182,
        155843314,
        156033702,
        156404524,
        156434697,
        156444512,
        156444569,
        156685519,
        156675690,
        156855217,
        156855366,
        157026182,
        157165555,
        157196061,
        157266983,
        157267284,
        157377236,
        157496864,
        157497021,
        157668446,
        157697406,
        157888656,
        157898724,
        157968823,
        157988771,
        158088844,
        158088846,
        158339657,
        158359726,
        158519893,
        158429892,
        158479272,
        158679874,
        158680011,
        158991100,
        159162181,
        159322476,
        159322501,
        159633828,
        159743731,
        160044271,
        160044501,
        160223904,
        160555187,
        160474998,
        160514736,
        160514975,
        161106902,
        161166828,
        161147038,
        161166357,
        161457472,
        162048967,
        162088425,
        162419508,
        162519812,
        162559954,
        162560108,
        162560212,
        162749722,
        162730499,
        162730546,
        163061260,
        163301602,
        163420408,
        163420435,
        163561830,
        163902897,
        164003383,
        164113364,
        164133503,
        164434780,
        164595248,
        164655680,
        164745744,
        164906042,
        164905608,
        164905609,
        165015908,
        165015909,
        165216421,
        165267033,
        165297124,
        165376754,
        165608225,
        165637449,
        165637725,
        165978998,
        166280225,
        166109822,
        166300100,
        166330539,
        166370263,
        166571751,
        166571931,
        166573683,
        167012906,
        166881812,
        167023223,
        167053306,
        167464257,
        167554803,
        167695331,
        167855056,
        167915219,
        168065887,
        168216057,
        168356000,
        168366276,
        168556425,
        168586685,
        168717259,
        168747365,
        168826890,
        168927814,
        168968282,
        169078281,
        169278734,
        169279105,
        169448628,
        169519409,
        169429531,
        169448218,
        169640574,
        169720834,
        169770363,
        170291565,
        170291566,
        170081532,
        170181301,
        170200583,
        171083438,
        171083475,
        171083500,
        171043323,
        171223672,
        171394328,
        171354591,
        171454983,
        171274296,
        171465384,
        171495401,
        171545227,
        171635473,
        171875262,
        171845878,
        171976398,
        171965645,
        172276871,
        172357266,
        172558239,
        172558368,
        172868864,
        173169410,
        173138466,
        173229127,
        173420683,
        173420692,
        173440786,
        173289779,
        173531263,
        173741449,
        173741453,
        173741606,
        173831848,
        173831929,
        173832076,
        173932781,
        173933086,
        174073617,
        174123437,
        174253074,
        174313095,
        174684264,
        174974769,
        175055808,
        175005058,
        175105604,
        175025056,
        175296415,
        175406258,
        175466330,
        175466807,
        175466965,
        175577035,
        175757807,
        175787830,
        175917889,
        176369809,
        176379777,
        176379874,
        176600004,
        176690136,
        176770179,
        176819982,
        176991155,
        177011539,
        177011340,
        177021686,
        177422588,
        177402796,
        177402930,
        177573019,
        177834238,
        177814366,
        177804463,
        177924295,
        178023385,
        178023543,
        178173915,
        178173916,
        178174056,
        178204046,
        178274958,
        178896441,
        178896452,
        179038188,
        179037181,
        179037812,
        179247072,
        179347409,
        179577867,
        179858292,
        179878423,
        180048891,
        180219183,
        180228768,
        180228769,
        180228865,
        180228907,
        180288863,
        180639991,
        180691394,
        180971257,
        181001734,
        180991529,
        181161600,
        181151885,
        181172069,
        181352441,
        181472238,
        181653777,
        181773529,
        182124493,
        182518695,
        182559200,
        182689687,
        182879812,
        182962079,
        183002111,
        182962053,
        182962061,
        183022246,
        183072419,
        183092446,
        183092447,
        183273607,
        183344485,
        183484502,
        183575106,
        183776026,
        183877106,
        183946834,
        183946885,
        184288766,
        184288768,
        184388387,
        184790369,
        184750248,
        184990479,
        185161035,
        185171634,
        185172066,
        185231813,
        185101633,
        185101710,
        185453329,
        185513943,
        185904413,
        185904590,
        186538165,
        186618772,
        186879149,
        187221153,
        187363770,
        187564291,
        187735220,
        188027644,
        188037691,
        188197412,
        188279079,
        188268888,
        188450177,
        188450301,
        188620104,
        188701322,
        188841446,
        189143045,
        189223288,
        188901921,
        188901992,
        188911672,
        189444913,
        189445224,
        189445309,
        189445542,
        189506019,
        189566141,
        189655317,
        189685995,
        189806344,
        189967020,
        189946544,
        189946844,
        190006240,
        190417897,
        190448361,
        190649190,
        190940059,
        190940067,
        190999717,
        191270863,
        191270936,
        191280527,
        191280634,
        191280665,
        191280747,
        191421681,
        191382005,
        191471940,
        191613268,
        191973915,
        192004990,
        192125571,
        192065418,
        192065428,
        192105201,
        192115269,
        192416833,
        192496783,
        192617593,
        192596676,
        192637624,
        192698371,
        192758170,
        192899044,
        193089888,
        193200231,
        193410635,
        193521460,
        193570923,
        193761891,
        193842363,
        194043128,
        194224051,
        194163315,
        194546414,
        194546524,
        194837513,
        194917508,
        194917785,
        194917795,
        194937559,
        195158633,
        195088260,
        195058105,
        195198893,
        195148669,
        195711613,
        195741728,
        195781624,
        195781625,
        195781660,
        195781664,
        195781826,
        195821906,
        195922902,
        196143661,
        196143851,
        196114173,
        196013207,
        196093512,
        196093875,
        196285276,
        196325578,
        196415401,
        196566082,
        196656107,
        196736937,
        196797411,
        196797437,
        197119361,
        196937894,
        197420404,
        197390656,
        197832017,
        197761876,
        197852223,
        197852310,
        197892834,
        197782041,
        197952730,
        198012597,
        197933103,
        197942690,
        197942691,
        197942692,
        198012839,
        198665937,
        198766790,
        198716613,
        198907338,
        199038443,
        199028030,
        198876840,
        198957449,
        198957526,
        199429666,
        199500179,
        199963022,
        199963074,
        199922420,
        200154189,
        200154351,
        200193512,
        200395017,
        200575470,
        200575700,
        200575860,
        200666751,
        200828423,
        200828066,
        201210371,
        201523897,
        201553829,
        201624105,
        201624137,
        201644060,
        201723929,
        201855874,
        201764695,
        201774799,
        201946372,
        201986424,
        201966457,
        201966458,
        201966793,
        202056857,
        202056917,
        202167579,
        202358502,
        202428407,
        202428616,
        202358159,
        202509126,
        202559525,
        202559676,
        202941242,
        202920994,
        203352467,
        203352669,
        203372640,
        203382877,
        203382937,
        203907118,
        203977517,
        204017490,
        204389412,
        204409376,
        204409425,
        204680804,
        204680805,
        204871975,
        204912024,
        204912044,
        204912075,
        204842056,
        204862238,
        204862237,
        205042637,
        205354094,
        205354095,
        205443899,
        205988397,
        205707568,
        205767787,
        206169425,
        206229538,
        206421347,
        206421350,
        206471770,
        206421102,
        206591757,
        206862938,
        206862939,
        206863215,
        206863316,
        206672288,
        206752616,
        206812555,
        206943401,
        206943408,
        206943434,
        206943439,
        206963418,
        207386355,
        207296401,
        207466882,
        207436709,
        207677041,
        207697176,
        207727430,
        207656909,
        207857810,
        207767174,
        207767652,
        207767717,
        207907901,
        207988609,
        208320380,
        208591129,
        208591419,
        208641850,
        208672027,
        208721991,
        208792212,
        208822403,
        208822405,
        208912284,
        209304704,
        209223868,
        209414688,
        209445275,
        209465879,
        209507110,
        209597163,
        210310331,
        210289847,
        210662807,
        210903994,
        210903995,
        210803166,
        211275512,
        211275514,
        211184549,
        211577039,
        211486747,
        211496463,
        211718079,
        211878638,
        212090494,
        212241425,
        212301953,
        212361698,
        212482365,
        212542683,
        212502368,
        212683412,
        212985093,
        213074962,
        213196210,
        213196243,
        213196301,
        213196366,
        213196390,
        213155333,
        213295785,
        213326495,
        213346319,
        212853806,
        212773879,
        213657946,
        212773933,
        214018187,
        214781592,
        215062579,
        215596268,
        215254176,
        215867531,
        216250609,
        216591315,
        216642062,
        216642065,
        217053808,
        217203872,
        217143850,
        217144004,
        217163940,
        217163977,
        217164007,
        217465697,
        217506464,
        217506471,
        217506473,
        218231960,
        218212409,
        218261830,
        218381495,
        218361499,
        218341964,
        218381575,
        218381110,
        218391311,
        218381227,
        218381267,
        218381269,
        218381271,
        218381273,
    };
    // ids.resize(600);
    auto res = holder.session.loadCompany(ids);
    std::cout << "size of result: " << res.size() << std::endl;
    return 0;
}